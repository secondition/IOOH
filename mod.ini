; EFMI Key Context Manager v3.0
; 按键上下文切换系统 - 基于选择器的按键绑定
; 
; 核心机制：选择器伪共享
;   - 每个mod独立检测自己的角色在场
;   - 所有mod共享同一个选择器变量$selected_character
;   - 通过↑↓键在所有mod中同步改变$selected_character
;   - 按键只在：角色在场 && $selected_character==ID 时生效
; 
; 作者: EFMI Community
; 配套工具: key_context_configurator.py

; ==================== 主控mod配置示例 ====================
; 本文件可作为主控mod放入Mods文件夹（可选）
; 或者直接将选择器控制代码插入到各个mod的ini文件中

[Constants]
global persist $selected_character = 0

; 注意：max_characters由Python脚本根据扫描结果自动确定
; 例如：扫描到3个mod，则角色ID为0,1,2

[KeySelectUp]
key = VK_UP
type = standard
run = CommandListSelectUp

[CommandListSelectUp]
if $selected_character > 0
    $selected_character = $selected_character - 1
else
    $selected_character = 0  ; 替换为实际角色数-1
endif

[KeySelectDown]
key = VK_DOWN
type = standard
run = CommandListSelectDown

[CommandListSelectDown]
if $selected_character < 0  ; 替换为实际角色数-1
    $selected_character = $selected_character + 1
else
    $selected_character = 0
endif

; ==================== 使用说明 ====================
;
; 1. 运行 key_context_configurator.py 扫描mods目录
; 2. 脚本自动为每个mod插入选择器控制代码
; 3. 游戏内按↑↓键切换角色ID，小键盘控制当前选中角色
;
; 原理：虽然变量不能跨mod传输，但按键输入是全局的！
;      所有mod都响应↑↓键，各自计算相同逻辑，结果保持一致
;
; ==================== 按键映射 ====================
; 
; 控制键：
;   ↑键 - 选择上一个角色（ID-1）
;   ↓键 - 选择下一个角色（ID+1）
;
; 功能键（单个mod内按检测顺序）：
;   第1个  -> VK_NUMPAD0
;   第2个  -> VK_NUMPAD1
;   ...
;   第10个 -> VK_NUMPAD9
;   第11个 -> VK_ADD (+)
;   第12个 -> VK_SUBTRACT (-)
;   第13个 -> VK_MULTIPLY (*)
;   第14个 -> VK_DIVIDE (/)
;   第15个 -> VK_DECIMAL (.)

; ==================== 自动生成区域 ====================
; Python脚本会在这里插入角色列表
; [GENERATED_START] - 角色ID映射（自动生成）
; ID 0 = laevatain_mk3l_7fa3f (13个按键, ✓有检测)
; ID 1 = 佩丽卡 (7个按键, ✓有检测)
; [GENERATED_END]
